"use strict";(self["webpackChunkvostorg_vue"]=self["webpackChunkvostorg_vue"]||[]).push([[825],{3825:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ie});var n=a(9835),l=a(499),o=a(9048),i=a(5883),s=a(6850),c=a(8910),u=a(1957),r=a(6970),d=a(4323),v=a(8882),f=a(442),p=function(e,t,a,n){function l(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,o){function i(e){try{c(n.next(e))}catch(t){o(t)}}function s(e){try{c(n["throw"](e))}catch(t){o(t)}}function c(e){e.done?a(e.value):l(e.value).then(i,s)}c((n=n.apply(e,t||[])).next())}))};const m={class:"text-right q-mt-sm"},g=(0,n.aZ)({setup(e){const t=(0,d.t)(),a=(0,i.M)(),o=t.user,{maxRule:g}=((0,c.yj)(),(0,v.bA)()),h=(0,s.F)(),{sendMessage:w}=a,{chat:{chatLenghtMax:y}}=h.config,S=(0,n.Fl)((()=>a.recipient)),U=(0,l.iH)(""),_=(0,l.iH)(!1),b=[e=>g(e,y)],x=(0,f.useReCaptcha)(),k=()=>p(this,void 0,void 0,(function*(){return yield null===x||void 0===x?void 0:x.recaptchaLoaded(),null===x||void 0===x?void 0:x.executeRecaptcha("message")})),q=()=>p(this,void 0,void 0,(function*(){var e;if(U.value){_.value=!0;try{yield w({text:U.value,recipient:null===(e=S.value)||void 0===e?void 0:e.id,recaptcha:yield k()}),_.value=!1,U.value=""}catch(t){_.value=!1}}}));return(e,t)=>{const a=(0,n.up)("q-input"),i=(0,n.up)("q-btn"),s=(0,n.up)("q-form");return(0,n.wg)(),(0,n.j4)(s,{onSubmit:q},{default:(0,n.w5)((()=>[(0,n.Wm)(a,{modelValue:U.value,"onUpdate:modelValue":t[0]||(t[0]=e=>U.value=e),modelModifiers:{trim:!0},disable:!(0,l.SU)(S)||(0,l.SU)(S).id===(0,l.SU)(o).id||_.value,label:e.$t("my.page.chat.text"),rules:b,counter:"",rows:"4",type:"textarea",onKeydown:(0,u.D2)((0,u.iM)(q,["prevent"]),["enter"])},null,8,["modelValue","disable","label","onKeydown"]),(0,n._)("div",m,[(0,n.Wm)(i,{to:{name:"search"},flat:""},{default:(0,n.w5)((()=>[(0,n.Uk)((0,r.zw)(e.$t("root.page.user.back")),1)])),_:1}),(0,l.SU)(S)?((0,n.wg)(),(0,n.j4)(i,{key:0,label:e.$t("my.page.chat.openProfile"),to:{name:"user",params:{id:(0,l.SU)(S).id}},flat:""},null,8,["label","to"])):(0,n.kq)("",!0),(0,n.Wm)(i,{disable:!(0,l.SU)(S)||(0,l.SU)(S).id===(0,l.SU)(o).id,loading:_.value,color:"primary",size:"xl",type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,r.zw)(e.$t("form.submit")),1)])),_:1},8,["disable","loading"])])])),_:1})}}});var h=a(8326),w=a(6611),y=a(8879),S=a(9984),U=a.n(S);const _=g,b=_;U()(g,"components",{QForm:h.Z,QInput:w.Z,QBtn:y.Z});var x=a(6921),k=a(4762),q=function(e,t,a,n){function l(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,o){function i(e){try{c(n.next(e))}catch(t){o(t)}}function s(e){try{c(n["throw"](e))}catch(t){o(t)}}function c(e){e.done?a(e.value):l(e.value).then(i,s)}c((n=n.apply(e,t||[])).next())}))};const Z={class:"q-pa-md row justify-center"},j={class:"full-width"},F={class:"row justify-center q-my-md"},$=(0,n.aZ)({setup(e){const t=(0,i.M)(),a=(0,d.t)(),o=(0,s.F)(),{upload:{userDir:c}}=o.config,u=`https://api.vostorg.net/${c}`,{fetchMessages:r}=t,v=(0,l.iH)(),f=(0,n.Fl)((()=>t.messages)),p=(0,n.Fl)((()=>t.isMessagesAllFetched)),m=(0,n.Fl)((()=>t.recipient)),g=a.user,h=(e,t)=>q(this,void 0,void 0,(function*(){m.value&&!p.value&&(yield r({id:m.value.id,page:e})),t(p.value)}));return(e,t)=>{const a=(0,n.up)("q-chat-message"),o=(0,n.up)("q-spinner-dots"),i=(0,n.up)("q-infinite-scroll");return(0,n.wg)(),(0,n.iD)("div",{ref_key:"scrollTargetRef",ref:v,class:"chat"},[(0,l.SU)(m)?((0,n.wg)(),(0,n.j4)(i,{key:0,ref:"infiniteScrollRef",offset:50,"scroll-target":v.value,onLoad:h},{loading:(0,n.w5)((()=>[(0,n._)("div",F,[(0,n.Wm)(o,{color:"primary",size:"40px"})])])),default:(0,n.w5)((()=>[(0,n._)("div",Z,[(0,n._)("div",j,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,l.SU)(f),(({id:e,createdAt:t,sender:o,text:i})=>((0,n.wg)(),(0,n.j4)(a,{key:e,avatar:o.id===(0,l.SU)(g).id?`${u}${(0,l.SU)(g).thumb}`:`${u}${(0,l.SU)(m).thumb}`,"bg-color":(0,l.SU)(g).id===o.id?"yellow-7":"teal-7",name:o.name,sent:(0,l.SU)(g).id===o.id,stamp:(0,l.SU)(k.Z)(new Date(t),{addSuffix:!0,locale:(0,l.SU)(x.Z)}),text:[i],"text-color":(0,l.SU)(g).id!==o.id?"white":"dark",class:"q-my-xl"},null,8,["avatar","bg-color","name","sent","stamp","text","text-color"])))),128))])])])),_:1},8,["scroll-target"])):(0,n.kq)("",!0)],512)}}});var M=a(1639),D=a(6870),W=a(396),Q=a(7501);const C=(0,M.Z)($,[["__scopeId","data-v-4e7fc96a"]]),z=C;U()($,"components",{QInfiniteScroll:D.Z,QChatMessage:W.Z,QSpinnerDots:Q.Z});const I={class:"row"},R={class:"col-12"},A=(0,n.aZ)({setup(e){const t=(0,i.M)(),a=(0,s.F)(),u=(0,c.yj)(),r=(0,n.Fl)((()=>t.recipient)),{upload:{userDir:d}}=a.config,v=`https://api.vostorg.net/${d}`,f=(0,n.Fl)((()=>(null===r||void 0===r?void 0:r.value)?[{label:r.value.name,route:u.fullPath,icon:`img:${v}${r.value.thumb}`}]:void 0));return(e,t)=>((0,n.wg)(),(0,n.j4)(o.Z,{menu:(0,l.SU)(f)},{default:(0,n.w5)((()=>[(0,n.Wm)(z),(0,n._)("div",I,[(0,n._)("div",R,[(0,n.Wm)(b)])])])),_:1},8,["menu"]))}}),H=A,P=H;var B=a(9),L=a(2502),K=function(e,t,a,n){function l(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,o){function i(e){try{c(n.next(e))}catch(t){o(t)}}function s(e){try{c(n["throw"](e))}catch(t){o(t)}}function c(e){e.done?a(e.value):l(e.value).then(i,s)}c((n=n.apply(e,t||[])).next())}))};const O={key:0,class:"text-center"},V=["src"],Y={class:"row justify-center q-my-md"},N=(0,n.aZ)({setup(e){const t=(0,i.M)(),a=(0,s.F)(),{fetchContacts:o,reloadContacts:u,reOrderContacts:d}=((0,c.yj)(),t),v=(0,l.iH)(null),f=(0,n.Fl)((()=>t.isContactsAllFetched)),p=(0,n.Fl)((()=>t.contactsWithRecipient)),m=(0,n.Fl)((()=>t.contacts)),g=(0,n.Fl)((()=>t.countNewMessagesByContacts)),h=(e,t)=>K(this,void 0,void 0,(function*(){f.value||(yield o()),t(f.value)})),{upload:{userDir:w},chat:{chatButtonBadgeMaxCount:y}}=a.config,S=`https://api.vostorg.net/${w}`,U=(0,n.Fl)((()=>Object.keys(t.countNewMessagesByContacts).length)),{showInfiniteScroll:_}=(0,L.Jk)(t);_.value=!1;const b=()=>K(this,void 0,void 0,(function*(){Object.keys(g.value).filter((e=>{var t;return!(null===(t=m.value)||void 0===t?void 0:t.map((({id:e})=>e)).includes(e))})).length>0?yield u():d()}));return(0,n.YP)(U,((e,t)=>{e>t&&b()})),(0,n.bv)((()=>K(this,void 0,void 0,(function*(){m.value&&U.value?(yield b(),_.value=!0):(m.value||(yield o()),_.value=!0)})))),(e,t)=>{const a=(0,n.up)("q-item-section"),o=(0,n.up)("q-avatar"),i=(0,n.up)("q-item"),s=(0,n.up)("q-list"),c=(0,n.up)("q-spinner-dots"),u=(0,n.up)("q-infinite-scroll");return(0,n.wg)(),(0,n.iD)("div",{ref_key:"scrollTargetRef",ref:v,class:"contacts"},[(0,l.SU)(_)?((0,n.wg)(),(0,n.j4)(u,{key:0,offset:50,"scroll-target":v.value,onLoad:h},{loading:(0,n.w5)((()=>[(0,n._)("div",Y,[(0,n.Wm)(c,{color:"primary",size:"40px"})])])),default:(0,n.w5)((()=>[(0,l.SU)(p)&&0===(0,l.SU)(p).length&&(0,l.SU)(f)?((0,n.wg)(),(0,n.iD)("div",O,(0,r.zw)(e.$t("my.page.chat.usersEmpty")),1)):((0,n.wg)(),(0,n.j4)(s,{key:1,separator:""},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,l.SU)(p),(({id:e,name:t,thumb:s})=>((0,n.wg)(),(0,n.j4)(i,{id:`user_${e}`,key:e,to:{name:"my-chat",params:{id:e},query:{_reset:Math.random().toString(36).substring(7)}},"active-class":"active",class:"q-py-lg"},{default:(0,n.w5)((()=>[(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,r.zw)(t),1)])),_:2},1024),(0,n.Wm)(a,{avatar:""},{default:(0,n.w5)((()=>[(0,n.Wm)(o,{size:"50px"},{default:(0,n.w5)((()=>[(0,l.SU)(g)[e]&&(0,l.SU)(g)[e]>0?((0,n.wg)(),(0,n.j4)(B.Z,{key:0,count:(0,l.SU)(g)[e]>(0,l.SU)(y)?`${(0,l.SU)(y)}+`:(0,l.SU)(g)[e]},null,8,["count"])):(0,n.kq)("",!0),(0,n._)("img",{src:`${S}${s}`,alt:""},null,8,V)])),_:2},1024)])),_:2},1024)])),_:2},1032,["id","to"])))),128))])),_:1}))])),_:1},8,["scroll-target"])):(0,n.kq)("",!0)],512)}}});var T=a(3246),E=a(490),J=a(1233),G=a(1357);const X=(0,M.Z)(N,[["__scopeId","data-v-a323915e"]]),ee=X;U()(N,"components",{QInfiniteScroll:D.Z,QList:T.Z,QItem:E.Z,QItemSection:J.Z,QAvatar:G.Z,QSpinnerDots:Q.Z});const te={class:"row q-col-gutter-md"},ae={class:"col-12 col-xl-9 col-lg-8 col-md-7"},ne={class:"col-12 col-xl-3 col-lg-4 col-md-5"},le=(0,n.aZ)({setup(e){const t=(0,i.M)(),a=(0,c.yj)(),{clearMessages:l,fetchRecipient:o}=t;return(0,n.bv)((()=>{o(a.params.id)})),(0,n.Ah)((()=>{l()})),(e,t)=>((0,n.wg)(),(0,n.iD)("div",te,[(0,n._)("div",ae,[(0,n.Wm)(P)]),(0,n._)("div",ne,[(0,n.Wm)(ee)])]))}}),oe=le,ie=oe}}]);